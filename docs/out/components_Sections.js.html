<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>components/Sections.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BackwardControl.html">BackwardControl</a><ul class='methods'><li data-type='method'><a href="BackwardControl.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="BackwardControl.html#createElement">createElement</a></li><li data-type='method'><a href="BackwardControl.html#onClick">onClick</a></li></ul></li><li><a href="Component.html">Component</a><ul class='methods'><li data-type='method'><a href="Component.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="Component.html#createElement">createElement</a></li></ul></li><li><a href="Control.html">Control</a><ul class='methods'><li data-type='method'><a href="Control.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="Control.html#createElement">createElement</a></li><li data-type='method'><a href="Control.html#onClick">onClick</a></li></ul></li><li><a href="ControlCheckbox.html">ControlCheckbox</a><ul class='methods'><li data-type='method'><a href="ControlCheckbox.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="ControlCheckbox.html#onChecked">onChecked</a></li><li data-type='method'><a href="ControlCheckbox.html#onClick">onClick</a></li></ul></li><li><a href="ControlCollection.html">ControlCollection</a><ul class='methods'><li data-type='method'><a href="ControlCollection.html#createElement">createElement</a></li></ul></li><li><a href="ControlContainer.html">ControlContainer</a><ul class='methods'><li data-type='method'><a href="ControlContainer.html#addItem">addItem</a></li><li data-type='method'><a href="ControlContainer.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="ControlContainer.html#createElement">createElement</a></li><li data-type='method'><a href="ControlContainer.html#getByIndex">getByIndex</a></li><li data-type='method'><a href="ControlContainer.html#onItemClick">onItemClick</a></li><li data-type='method'><a href="ControlContainer.html#setActiveByIndex">setActiveByIndex</a></li></ul></li><li><a href="ControlDropdown.html">ControlDropdown</a><ul class='methods'><li data-type='method'><a href="ControlDropdown.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="ControlDropdown.html#createElement">createElement</a></li><li data-type='method'><a href="ControlDropdown.html#onClick">onClick</a></li></ul></li><li><a href="ControlText.html">ControlText</a><ul class='methods'><li data-type='method'><a href="ControlText.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="ControlText.html#createElement">createElement</a></li></ul></li><li><a href="DownloadControl.html">DownloadControl</a><ul class='methods'><li data-type='method'><a href="DownloadControl.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="DownloadControl.html#createElement">createElement</a></li></ul></li><li><a href="ErrorDisplay.html">ErrorDisplay</a><ul class='methods'><li data-type='method'><a href="ErrorDisplay.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="ErrorDisplay.html#createElement">createElement</a></li></ul></li><li><a href="FullscreenControl.html">FullscreenControl</a><ul class='methods'><li data-type='method'><a href="FullscreenControl.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="FullscreenControl.html#createElement">createElement</a></li><li data-type='method'><a href="FullscreenControl.html#onClick">onClick</a></li></ul></li><li><a href="Icon.html">Icon</a><ul class='methods'><li data-type='method'><a href="Icon.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="Icon.html#createElement">createElement</a></li></ul></li><li><a href="KeyBindingInfoControl.html">KeyBindingInfoControl</a><ul class='methods'><li data-type='method'><a href="KeyBindingInfoControl.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="KeyBindingInfoControl.html#createElement">createElement</a></li><li data-type='method'><a href="KeyBindingInfoControl.html#onClick">onClick</a></li></ul></li><li><a href="MiniPlayer.html">MiniPlayer</a><ul class='methods'><li data-type='method'><a href="MiniPlayer.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="MiniPlayer.html#createElement">createElement</a></li><li data-type='method'><a href="MiniPlayer.html#hide">hide</a></li><li data-type='method'><a href="MiniPlayer.html#onClick">onClick</a></li><li data-type='method'><a href="MiniPlayer.html#show">show</a></li></ul></li><li><a href="PlayButton.html">PlayButton</a><ul class='methods'><li data-type='method'><a href="PlayButton.html#buildCSSClass">buildCSSClass</a></li></ul></li><li><a href="PlayControl.html">PlayControl</a><ul class='methods'><li data-type='method'><a href="PlayControl.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="PlayControl.html#createElement">createElement</a></li><li data-type='method'><a href="PlayControl.html#onClick">onClick</a></li><li data-type='method'><a href="PlayControl.html#pause">pause</a></li><li data-type='method'><a href="PlayControl.html#play">play</a></li></ul></li><li><a href="Player.html">Player</a><ul class='methods'><li data-type='method'><a href="Player.html#.plugin">plugin</a></li><li data-type='method'><a href="Player.html#_initPlugins">_initPlugins</a></li><li data-type='method'><a href="Player.html#addClass">addClass</a></li><li data-type='method'><a href="Player.html#getControls">getControls</a></li><li data-type='method'><a href="Player.html#getData">getData</a></li><li data-type='method'><a href="Player.html#getHeight">getHeight</a></li><li data-type='method'><a href="Player.html#getView">getView</a></li><li data-type='method'><a href="Player.html#getWidth">getWidth</a></li><li data-type='method'><a href="Player.html#on">on</a></li><li data-type='method'><a href="Player.html#removeClass">removeClass</a></li><li data-type='method'><a href="Player.html#setError">setError</a></li><li data-type='method'><a href="Player.html#setUserActive">setUserActive</a></li><li data-type='method'><a href="Player.html#setView">setView</a></li><li data-type='method'><a href="Player.html#toggleClass">toggleClass</a></li><li data-type='method'><a href="Player.html#trigger">trigger</a></li></ul></li><li><a href="Poster.html">Poster</a><ul class='methods'><li data-type='method'><a href="Poster.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="Poster.html#createElement">createElement</a></li></ul></li><li><a href="RateControl.html">RateControl</a><ul class='methods'><li data-type='method'><a href="RateControl.html#_onClick">_onClick</a></li><li data-type='method'><a href="RateControl.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="RateControl.html#createElement">createElement</a></li><li data-type='method'><a href="RateControl.html#onClick">onClick</a></li><li data-type='method'><a href="RateControl.html#onPlayerInited">onPlayerInited</a></li></ul></li><li><a href="SectionControl.html">SectionControl</a><ul class='methods'><li data-type='method'><a href="SectionControl.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="SectionControl.html#onChecked">onChecked</a></li><li data-type='method'><a href="SectionControl.html#onClick">onClick</a></li></ul></li><li><a href="Sections.html">Sections</a><ul class='methods'><li data-type='method'><a href="Sections.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="Sections.html#createElement">createElement</a></li><li data-type='method'><a href="Sections.html#onPlayerInited">onPlayerInited</a></li></ul></li><li><a href="ShowTimeControl.html">ShowTimeControl</a><ul class='methods'><li data-type='method'><a href="ShowTimeControl.html#buildCSSClass">buildCSSClass</a></li></ul></li><li><a href="SourceControl.html">SourceControl</a><ul class='methods'><li data-type='method'><a href="SourceControl.html#onClick">onClick</a></li></ul></li><li><a href="SubtitleControl.html">SubtitleControl</a><ul class='methods'><li data-type='method'><a href="SubtitleControl.html#addItem">addItem</a></li><li data-type='method'><a href="SubtitleControl.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="SubtitleControl.html#createElement">createElement</a></li><li data-type='method'><a href="SubtitleControl.html#getByIndex">getByIndex</a></li><li data-type='method'><a href="SubtitleControl.html#onItemClick">onItemClick</a></li><li data-type='method'><a href="SubtitleControl.html#setActiveByIndex">setActiveByIndex</a></li></ul></li><li><a href="TimeInfoControl.html">TimeInfoControl</a><ul class='methods'><li data-type='method'><a href="TimeInfoControl.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="TimeInfoControl.html#createElement">createElement</a></li><li data-type='method'><a href="TimeInfoControl.html#onClick">onClick</a></li><li data-type='method'><a href="TimeInfoControl.html#onPlayerInited">onPlayerInited</a></li></ul></li><li><a href="VolumeControl.html">VolumeControl</a><ul class='methods'><li data-type='method'><a href="VolumeControl.html#buildCSSClass">buildCSSClass</a></li><li data-type='method'><a href="VolumeControl.html#createElement">createElement</a></li><li data-type='method'><a href="VolumeControl.html#onClick">onClick</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-time.html">time</a><ul class='methods'><li data-type='method'><a href="module-time.html#.percentify">percentify</a></li><li data-type='method'><a href="module-time.html#.secondsToTime">secondsToTime</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#element">element</a></li><li><a href="global.html#excludeArray">excludeArray</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">components/Sections.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';
/**
 * @file Sections.js
 */

import $ from 'jquery';
import Component from './Component';

import { secondsToTime } from '../utils';

/**
 * @class Sections
 * @param {Player} player Main player
 * @param {Object} [options]
 * @param {Array} [options.items=[]} Data for sections
 * @param {Boolean} [options.views] Show section only in fullscreen
 * @extends Component
 */
class Sections extends Component {
	constructor(player, options) {
		let { items = [], main = true } = options;
		items = [].concat(items);

		//options.items = items;

		super(player, options)
		this.activeSection = this.getSectionByIndex(0);

		this.items = items;
		this.length = this.items.length

		this.setActiveByIndex(0);

		this.element
			.find('.leplayer-section')
			.on('click', this.onSectionClick.bind(this));

		this.player.on('sectionstoggle', this._onSectionsToggle.bind(this));

		this.player.on('timeupdate', this.onTimeUpdate.bind(this));

		this.player.on('inited', this.onPlayerInited.bind(this));

		return this;
	}

	next() {
		const sectionIndex = parseInt(this.activeSection.attr('data-index'));
		const newIndex = sectionIndex >= this.length ? this.length : sectionIndex + 1;

		this.setActiveByIndex(newIndex);

		this.player.video.currentTime = this.items[sectionIndex].end;
	}

	prev() {
		const sectionIndex = parseInt(this.activeSection.attr('data-index'));
		const newIndex = sectionIndex &lt;= 0 ? 0 : sectionIndex - 1;

		this.setActiveByIndex(newIndex);
		this.player.video.currentTime = this.items[newIndex].begin;
	}

	/**
	 * @override
	 */
	createElement() {
		this.element = $('&lt;div />').addClass('leplayer-sections');
		if(this.options.fullscreenOnly) {
			this.element.addClass('leplayer-sections--fsonly');
		}
		this.element.append(this._createSections(this.options.items));
		return this.element;
	}

	/**
	 * @override
	 */
	onPlayerInited() {

		if(this.items != null &amp;&amp; this.items.length > 0 ) {
			this.items[this.items.length - 1].end = this.player.video.duration;
		}
	}



	onSectionClick(e) {
		const video = this.player.video;
		const section = $(e.target).closest('.leplayer-section');
		video.currentTime = section.attr('data-begin');
		this.player.trigger('sectionsclick', { section : this.items[section.attr('data-index')]});
	}

	setActiveByIndex(index) {
		if (
			this.activeSection.length == 0 ||
			this.activeSection.attr('data-index') == index ||
			this.getSectionByIndex(index).length == 0
		) {
			return this
		}

		this.activeSection.removeClass('leplayer-section--active');
		this.activeSection = this.getSectionByIndex(index);
		this.activeSection.addClass('leplayer-section--active');

		const topPosition = this.activeSection.position().top;

		if(this.player.getView() !== 'mini') {
			this.element
				.animate({
					scrollTop : this.element.scrollTop() + topPosition
				}, 800)
		}

		return this
	}

	getSectionByIndex(index) {
		return this.element.find(`.leplayer-section[data-index="${index}"]`);
	}


	onTimeUpdate(e, data) {
		if (this.activeSection.length == 0) {
			return
		}

		const currentTime = data.time;

		// Update span with end section time
		// TODO: Вынести это в отдельный компонент ShowTime или типо того
		if(this.player.getView() === 'mini' ) {
			const endSectionTime = this.activeSection.attr('data-end');
			this.activeSection
				.next()
				.find('.time')
				.text(secondsToTime(endSectionTime - currentTime));
		}

		for (let i = 0; i &lt; this.items.length; i++) {
			const section = this.items[i];
			if (currentTime &lt; section.end) {
				this.setActiveByIndex(i)
				break;
			}
		}
	}

	_onSectionsToggle(e, data) {
		if (this.element.hasClass('leplayer-sections--hidden') &amp;&amp; data.checked) {
			this.element.removeClass('leplayer-sections--hidden');
		} else if (!data.checked) {
			this.element.addClass('leplayer-sections--hidden');
		}
	}

	_createSections(items) {
		let result = '';
		items.forEach((section, index) => {
			const item = `
				&lt;div class="leplayer-section ${!index ? 'leplayer-section--active' : ''}"
					data-begin="${section.begin}"
					data-index="${index.toString()}"
					data-end="${section.end}">
					&lt;div class="leplayer-section-time">${secondsToTime(section.begin)}&lt;/div>
					&lt;div class="leplayer-section-info">
						&lt;div class="leplayer-section-next-info">
							Следующая секция начнется через
							&lt;span class="time">${secondsToTime(items[0].end)}&lt;/span>
						&lt;/div>
						${
							section.title != null ?
								`&lt;div class="leplayer-section-title">${section.title}&lt;/div>`
							: ''
						}
						${
							section.description != null ?
								`&lt;div class="leplayer-section-description">${section.description}&lt;/div>`
							: ''
						}
					&lt;/div>
				&lt;/div>
			`.trim()
			result += item;
		});
		return result;
	}
}

export default Sections;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Dec 07 2016 18:49:33 GMT+0300 (MSK) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
